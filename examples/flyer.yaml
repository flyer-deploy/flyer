template:
  name: web.nginx
  params:
    conf_file: deploy/web.nginx
    webroot: public/

    directives:
      - error_page:
          params: 404 /index.php
          prepend_basepath: true
      - index: index.php
      - charset: utf-8
      - add_header: 'x-frame-options "SAMEORIGIN"'
      - add_header: 'x-content-type-options "nosniff"'
      - add_header: "x-php-path $realpath_root/index.php always"
      - add_header: "x-uri $uri always"
      - add_header: "x-request-uri $request_uri always"

      - try_files: "$uri /index.php?$query_string"

      # - location:
      #     path: "."
      #     directives:
      #       - alias: ./
      #       - try_files: "$uri =404"

      - location:
          path: "/favicon.ico"
          directives:
            - access_log: off

      - location:
          path: "/robots.txt"
          directives:
            - access_log: off

      - location:
          path: "\\.php$"
          modifier: "~"
          prepend_basepath: false
          directives:
            - fastcgi_pass: "${FLYER_PHP_FPM_8_2_FCGI_URI}"
            - fastcgi_param: "SCRIPT_FILENAME $realpath_root/index.php"
            - include: "fastcgi_params"

      - location:
          path: "/\\.(?!well-known).*"
          modifier: "~"
          directives:
            - deny: all
            - access_log: off
            - log_not_found: off

permission:
  writable_paths:
    - path: storage
      recursive: true
      files_default_writable: true

remove:
  - composer.json
  - composer.lock
  - phpunit.xml

dependencies:
  - git
  - composer
  - ffmpeg
# logging:
#   drivers:
#     - type: promtail
#   files:
#     - file: storage/logs/**/*.log
